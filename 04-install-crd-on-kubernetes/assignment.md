---
slug: install-crd-on-kubernetes
id: zolv3abe59us
type: challenge
title: Install the new CRD on Kubernetes
teaser: Explore the Kubebuilder generated CRD and then install it on your Kubernetes
  cluster.
notes:
- type: text
  contents: |-
    In the previous challenge you created a controller and resource definition (CRD). Now is your chance to explore the resource CRD!

    **In this challenge you will:**
    * Understand how the CRD is represented in Golang code
    * Transform the code CRD to a yaml that can be installed in Kubernetes
    * Install the CRD using the provided `make` command
tabs:
- title: K8s Shell
  type: terminal
  hostname: kubernetes-vm
  workdir: /root/demo
- title: Code editor
  type: service
  hostname: kubernetes-vm
  path: /
  port: 8443
difficulty: basic
timelimit: 450
---

ðŸ§¬ Viewing the generated CRD code
==============

By selecting to create a Resource in the previous step, you have generated a Custom Resource Definition (CRD).

This CRD is first written in Golang code found in your `Code editor` tab under `api` > `v1beta1` > `website_types.go`.

You may not be familiar with Golang, but that is OK.

Have a look in the document `api/v1beta1/website_types.go` for the `type WebsiteSpec struct`. Think of this as the code definition of the Kubernetes object `spec`.

In `api/v1beta1/website_types.go:32` there is a field called `foo` and there is a helpful comment above it describing the use of `foo`.

The reason this is defined first in Golang is to allow reference these fields from the Golang controller. You will get experience using this a few challenges from now.


ðŸ‘©ðŸ¾â€ðŸ’» Creating a yaml version
==============

In order to install this Website CRD type into the Kubernetes cluster, it needs to be in yaml format. You will generate that yaml now and it will be stored under `config` > `crd` > `bases`.

Before generating this file, first go look at this location and see that currently there is no directory called `bases`. Both the directory and the file inside the directory will be generated by the next command.

The `install` make target handles all this heavy lifting through its prerequisite targets. Remember that each time you run `make install`, it will start by running all of its prerequisites. In the case of `install`, the prerequisites are described at `Makefile:86`:

> install: manifests kustomize

Now run the prerequisite target `manifests` manually in the `K8s Shell` tab to view the Golang translated into yaml:

```
make manifests
```

Return to the `Code editor` tab to see a new file populated in the `bases` directory you previously did not see. Find the field `foo` in this yaml to see how it has been translated from Golang.

In particular, `config` > `crd` > `bases` > `kubecon.my.domain_websites.yaml:37` lists the website properties found in the `WebsiteSpec` schema. That property is `foo` and it has used the helpful comment as a property description.

Now it is time to actually put this CRD into your Kubernetes cluster.


ðŸš€ Installing the CRD into your Kubernetes cluster
==============

The generated YAML is in written in [Kustomize](https://kustomize.io/). This means that it is combined with a number of other files before it is fully prepare to be installed in the cluster. Kubebuilder provides a make target to codify this further configuration of the yaml as well as the application of the final yaml files to Kubernetes.

To see current state of your cluster, start by viewing all current CRDs in the Kubernetes cluster by running the following command in the `K8s Shell` tab:

```
kubectl get crds
```

While there are other CRDs installed, website is not yet on the list.

Now run the make command to install your new website CRD:

```
make install
```

If you `kubectl get crds` again, you will see the `websites.kubecon.my.domain` listed there at the bottom of the list.


ðŸ“• Summary
==============

After this challenge you have successfully installed a new Custom Resource Definition onto your Kubernetes cluster!

Soon you will request an instance (or Custom Resource) from this definition. But first, you will get to dig into the controller that you created alongside this CRD.
