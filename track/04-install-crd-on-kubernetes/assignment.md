---
slug: install-crd-on-kubernetes
id: zolv3abe59us
type: challenge
title: Install the new CRD on Kubernetes
teaser: Explore the Kubebuilder generated CRD and then install it on your Kubernetes
  cluster.
notes:
- type: text
  contents: |-
    In the previous challenge you created a operator and resource definition (CRD). Now is your chance to explore the resource CRD!

    **In this challenge you will:**
    * Understand the Golang code representation of the CRD
    * Transform the code CRD into YAML and install it in Kubernetes
    * Install the CRD using the provided `make` command
tabs:
- title: K8s Shell
  type: terminal
  hostname: kubernetes-vm
  workdir: /root/demo
- title: Code editor
  type: service
  hostname: kubernetes-vm
  path: /
  port: 8443
difficulty: basic
timelimit: 1
---

ðŸ§¬ Viewing the generated CRD code
==============

In the last step you selected to generate a custom Resource. This adds a Golang representation of a Custom Resource Definition (CRD) to your operator scaffolding code.

To view this code, navigate to your `Code editor` tab under `api` > `v1beta1` > `website_types.go`.

You may not be familiar with Golang, but that is OK.

Have a look in the document `api/v1beta1/website_types.go` for the `type WebsiteSpec struct`.

> ðŸ’¡ You can use `ctrl+f` (`cmd+f` on mac) to search within a file and `ctrl+shift+f` (`cmd+shift+f` on mac) to search across files. This may help if you are less familiar with Golang and are following the instructions closely.

This as the code definition of the Kubernetes object `spec`. This spec contains a field named `foo` which is defined in `api/v1beta1/website_types.go:32`. There is even a helpful comment above the field describing the use of `foo`.

The CRD is defined first in Golang so that the operator (also written in Golang) can reference the definition. You will see this benefit in the next challenge.


ðŸ‘©ðŸ¾â€ðŸ’» Creating a YAML version
==============

To install this Website CRD type into the Kubernetes cluster, it needs to be in YAML format. You will generate that YAML now and it will appear  under `config` > `crd` > `bases`.

Before generating this file, first go look at this location and see that currently there is no directory called `bases`. Both the directory and the file inside the directory will get generated by the next command.

The `install` make target handles all this heavy lifting through its prerequisite targets. Remember that each time you run `make install`, it will start by running all prerequisites. In the case of `install`, the prerequisites are listed at `Makefile:86`:

> install: manifests kustomize
Now run only the prerequisite target `manifests` manually in the `K8s Shell` tab to view the Golang translated into yaml:

```
make manifests
```

Return to the `Code editor` tab to see a new file populated in the `bases` directory that did not exist previously. Then find the field `foo` in this YAML to see how it has been transformed from Golang.

In particular, `config` > `crd` > `bases` > `kubecon.my.domain_websites.yaml:37` lists the website properties found in the `WebsiteSpec` schema. The only property is `foo` and it has used the helpful comment as a property description.

Now it is time to actually put this CRD into your Kubernetes cluster.


ðŸš€ Installing the CRD into your Kubernetes cluster
==============

The generated YAML is actually part of a larger collection defined in [Kustomize](https://kustomize.io/). This means that the YAML files are templated with other files before installing in the cluster. Kubebuilder provides a single make target that templates the final YAML files and applies them to the Kubernetes cluster.

Before installing, you should understand the current state of your cluster. Start by viewing all current CRDs in by running the following command in the `K8s Shell` tab:

```
kubectl get crds
```

While there are other CRDs installed, website is not yet on the list.

Now run the make command to install your new website CRD:

```
make install
```

If you `kubectl get crds` again, you will see the `websites.kubecon.my.domain` listed at the bottom of the list.


ðŸ“• Summary
==============

You have successfully installed a new Custom Resource Definition onto your Kubernetes cluster!

Soon you will request an instance (or Custom Resource) from this definition. But first, you will get to dig into the operator that you created alongside this CRD.
